<div id="sniffer-search-wrap">

  <div id="map-wrap">
    <div id="map"></div>

    <div id="map-overlay-wrap-1">
      <div id="map-overlay-wrap-2">
        <div id="map-overlay">
          <h1> <%= _('Opportunities Sniffer') %> </h1>

          <div id="product-search" class="search-box">
            <div class="legend">
              <span><%= _('Suppliers') %></span>
              <span><%= _('Consumers') %></span>
            </div>

            <div class="search-field">
              <input type="text" class="search-input"/>
              <div class="search-submit">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="legend-wrap-1">
    <div id="legend-wrap-2">
      <div id="legend">
        <span> <b> <%= _('Reading') %> </b> </span>
        <img src="http://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png"/> <span><%= _("your enterprise") %></span>
        <img src="http://www.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png"/> <span><%= _("suppliers") %></span>
        <img src="http://www.google.com/intl/en_us/mapfiles/ms/micons/ltblue-dot.png"/> <span><%= _("consumers") %></span>
        <img src="http://www.google.com/intl/en_us/mapfiles/ms/micons/yellow-dot.png"/> <span><%= _("both") %></span>
      </div>
    </div>
  </div>
</div>

<%= content_tag 'script', '', :src => "http://maps.googleapis.com/maps/api/js?sensor=false", :type => 'text/javascript' %>
<%= javascript_include_tag 'google_maps' %>

<% json_opts = {:only => [:id, :name, :lat, :lng], :methods => [:distance]} %>
<% map_data = @profiles.select{ |profile, data| profile.lat and profile.lng } %>

<script type='text/javascript'>
  sniffer.map.load({
      zoom: <%= GoogleMaps.initial_zoom.to_json %>,
      balloonUrl: '<%= url_for(:controller => :sniffer_plugin_myprofile, :action => :map_balloon, :id => "<id>", :escape => false) %>',
      myBalloonUrl: '<%= url_for(:controller => :sniffer_plugin_myprofile, :action => :map_balloon, :escape => false) %>',
      profile: <%= profile.to_json json_opts %>,
      mapData: <%= map_data.to_json %>,
  });
</script>

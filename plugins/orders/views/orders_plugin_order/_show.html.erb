<div id="order-<%=order.id%>" class="order-view <%= "editable" if order.may_edit? user, @admin rescue false %> <%= "admin" if @admin %>">

  <% form_for :order, order, :url => {:controller => (if @admin then :orders_plugin_admin else :orders_plugin_order end), :action => :edit, :id => order.id},
    :html => {:onsubmit => 'return orders.order.submit(this)'} do |f| %>

    <div class="order-data <%= "admin" if @admin %>">

      <%= yield :order_header %>

      <%= render "orders_plugin_item/index", :order => order, :actor_name => actor_name %>

      <%= render 'orders_plugin_order/supplier_delivery', :order => order %>

    </div>

    <%= yield :order_footer %>

    <div class="actions">
      <% if @admin %>
        <%# link_to t('orders_plugin.views.admin._edit.edit_on_the_order_pag'), {:controller => :orders_plugin_order, :action => :edit, :id => order.id}, :target => '_blank', :class => 'action-button' %>

        <%= colorbox_link_to t('orders_plugin.views.admin._edit.message_to_member'), {:controller => :orders_plugin_message, :action => :new_to_consumer_for_order, :order_id => order.id}, :class => 'action-button' %>

        <% if order.next_status %>
          <%= f.submit t("models.order.statuses_verbs.#{order.next_status}") %>&emsp;
        <% end %>
      <% else %>
        <% if order.open? %>
          <div>
            <%= hidden_field_tag "order[status]", 'ordered' %>
            <%= f.submit t('views.order._show.confirm_order'), :confirm => t('views.order._show.confirming_this_order') %>&emsp;

            <%= link_to t('views.order._show.cancel_order'), {:action => :cancel, :id => order.id} %>
          <% end %>
        </div>
      <% end %>
    </div>

  <% end %>
</div>

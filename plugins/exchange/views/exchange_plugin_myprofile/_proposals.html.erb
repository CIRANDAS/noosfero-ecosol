<% first = true %>

<% @proposals.each do |proposal| %>

  <% if !(proposal.state == "open" && proposal.enterprise_origin != profile) %>

    <div class="exchange-proposal-wrap">

      <% if proposal.state != "open" %>
        <p class="exchange-proposal-sent">
          <%= _('Proposal sent ') + proposal.date_sent.strftime(_("%m/%d/%Y at H:%Mh")) %>
        </p>
      <% end %>

      <div class="exchange-proposal">
        <%= render :partial => "proposal_header", :locals => {:proposal => proposal} %>

        <% new_message = first and (@exchange.state == "proposal" or @exchange.state == "negociation") %>
        <% if new_message %>
          <%= render :partial => "proposal_buttons", :locals => {:proposal => proposal} %>
        <% end %>
        <%= render :partial => 'proposal_messages', :locals => {:proposal => proposal, :new_message => new_message} %>
        <% first = false %>

        <div class="exchange-proposal_offer_request_wrapper">
          <div class="exchange-proposal-offer">
            <h3><%= _('You offer') %></h3>
            <%= render :partial => 'proposal_element_list', :locals => {:proposal => proposal, :profile => @profile, :actor => 'profile' } %>

            <% if proposal.state == "open" %>

              <h3><%= _('What you can offer?') %></h3>

              <div class="exchange-button-wrapper">
                <%= render :partial => 'proposal_unreg_items', :locals => {:profile => profile, :actor => 'profile'} %>
                <%= render :partial => 'proposal_moneys', :locals => {:profile => @theother, :actor => 'theother'} %>
              </div>

              <%= render :partial => 'proposal_offers', :locals => {:profile => profile, :actor => 'profile'} %>
              <%= render :partial => 'proposal_knowledges', :locals => {:profile => profile, :actor => 'profile'} %>

            <% end %>

          </div>
          <div class="exchange-proposal-request">
            <h3><%= _('You ask') %></h3>
            <%= render :partial => 'proposal_element_list', :locals => {:proposal => proposal, :profile => @theother, :actor => 'theother' } %>

            <% if proposal.state == "open" %>

              <h3><%= _('What do the other can offer?') %></h3>
              <div class="exchange-button-wrapper">
                <%= render :partial => 'proposal_unreg_items', :locals => {:profile => @theother, :actor => 'theother'} %>

                <%= render :partial => 'proposal_moneys', :locals => {:profile => @theother, :actor => 'theother'} %>
              </div>

              <%= render :partial => 'proposal_offers', :locals => {:profile => @theother, :actor => 'theother'} %>
              <%= render :partial => 'proposal_knowledges', :locals => {:profile => @theother, :actor => 'theother'} %>

            <% end %>

          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>

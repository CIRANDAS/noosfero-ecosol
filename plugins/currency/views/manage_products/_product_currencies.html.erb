<% javascript_tag do %>
  addScript('/plugins/currency/underscore-min.js', currency.underscore_settings);
  currency.product.load({
    currencies: <%= @product.enterprise.currencies.to_json %>,
    prices: <%= @product.product_currencies.with_price.all.to_json %>,
    discounts: <%= @product.product_currencies.with_discount.all.to_json %>,
  });
<% end %>

<script id="currency-template" type="text/html">
  <@ _.each(currencies, function(currency) { @>
    <tr>
      <td>
        <label name="product[currencies[<@=currency.id@>][<@=field@>]]" class='formlabel'>
          <@ if (field == 'price') { @>
            <@= "<%= _('Price in %{currency}') %>".format({currency: currency.name_with_symbol}) @>
          <@ } else { @>
            <@= "<%= _('Discount in %{currency}') %>".format({currency: currency.name_with_symbol}) @>
          <@ } @>
        </label>
      </td>
      <td class='formfield'>
        <input name="product[currencies[<@=currency.id@>][<@=field@>]]" value="<@=currency[field] || ''@>" type="text" class='numbers-only'/>
      </td>
    </tr>
  <@ }); @>
</script>

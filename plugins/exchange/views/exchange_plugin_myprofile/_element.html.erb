<% e = element.object_type.constantize.find element.object_id %>
<% type = element.object_type.gsub('::', '').underscore %>

<li id="exchange-<%=type%>-element-<%= element.object_id %>" class="exchange-element <%= actor %>">

  <% if element.object_type == "Product" %>
    <div class="exchange-element-image" style="background-image: url('<%= e.image.public_filename if e.image %>');">
    </div>
  <% end %>

  <div class="exchange-element-control">

    <% if element.proposal.state == "open" %>

      <div id="exchange-quantity" class="exchange-qty">
        <div class="label"><%= _('Qty') %></div>
        <%= text_field_tag "origin_quantity[#{element.object_id}]", element.quantity, :class => "exchange-qty-input",
          :onBlur => "jQuery.post('#{url_for :action => 'update_quantity', :object_id => element.id}', {quantity: jQuery(this).val()});"%>
      </div>

      <div class="exchange-trash">

        <% if element.object_type == "Product" or element.object_type == "CmsLearningPlugin::Learning" %>
          <%= link_to_remote '<img src="/plugins/exchange/images/trash.png"/>', :url => {:action => :remove_element, :id => element.id, :object_type => element.object_type, :object_id => element.object_id, :actor => actor, :exchange_id => element.proposal.exchange_id, :proposal_id => element.proposal_id} %>
        <% else %>
          <%= link_to_remote '<img src="/plugins/exchange/images/trash.png"/>', :url => {:action => :remove_element_currency, :id => element.id, :object_type => element.object_type, :object_id => element.object_id, :actor => actor, :exchange_id => element.proposal.exchange_id, :proposal_id => element.proposal_id} %>
        <% end %>
      </div>


    <% else %>
      <% if !element.quantity.blank? %>
        <div class="exchange-qty readonly">
          <div class="label"><%= _('Qty') %></div>
          <div class="value"><%= element.quantity %></div>
        </div>
      <% end %>
    <% end %>
  </div>

  <% if element.object_type == "Product" %>
    <div class="exchange-element-title"><%= link_to e.name, e.url, :target => '_blank' %></div>
    <div class="exchange-element-desc"><%= e.description %></div>
  <% elsif element.object_type == "CmsLearningPlugin::Learning" %>
    <div class="exchange-element-title"><%= link_to e.name, e.url, :target => 'blank' %></div>
    <div class="exchange-element-desc"><%= e.summary %></div>
  <% elsif element.object_type == "CurrencyPlugin::Currency" %>
    <div class="exchange-element-title"><%= e.name_with_symbol %></div>
  <% elsif element.object_type == "ExchangePlugin::UnregisteredItem" %>
    <div class="exchange-element-title"><%= e.name %></div>
    <div class="exchange-element-desc"><%= e.description %></div>
  <% end %>
</li>
